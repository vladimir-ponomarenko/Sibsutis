# Лабораторная работа №12: Ментальный покер с GUI

## Описание
Реализация протокола "Ментальный покер" с графическим интерфейсом для игры в Техасский холдем. Протокол позволяет игрокам играть в покер без доверенного дилера, используя криптографические методы для обеспечения честности и безопасности.

## Теоретические основы

### Протокол Ментальный покер
Ментальный покер - это криптографический протокол, который позволяет игрокам играть в покер без доверенного дилера. Все операции выполняются криптографически, что обеспечивает честность игры.

### Основные принципы
1. **Честность**: Никто не может подглядеть карты других игроков
2. **Безопасность**: Карты не могут быть подделаны
3. **Анонимность**: Игроки не знают карты друг друга до их раскрытия
4. **Проверяемость**: Все операции могут быть проверены

### Криптографические основы
- **Коммутативное шифрование**: Все игроки используют один модуль P
- **Пара ключей**: Каждый игрок i имеет пару (Ci, Di) где Ci * Di ≡ 1 (mod P-1)
- **Шифрование**: E(m) = m^Ci mod P
- **Расшифрование**: D(m) = m^Di mod P
- **Последовательное шифрование**: Каждый игрок шифрует колоду своим ключом

## Алгоритм работы

### 1. Инициализация системы
**Криптографические параметры**:
- Выбирается большое простое число p (модуль)
- Каждый игрок i генерирует пару ключей (Ci, Di)
- Условие: Ci * Di ≡ 1 (mod p-1)

**Генерация ключей**:
```python
def setup_cryptographic_parameters(self):
    self.p = 1009  # Простое число
    
    for i in range(self.num_players):
        while True:
            Ci = random.randint(1, self.p - 1)
            if self.gcd(Ci, self.p - 1) == 1:
                break
        
        Di = self.mod_inverse(Ci, self.p - 1)
        self.player_keys[i] = (Ci, Di)
```

### 2. Подготовка колоды
**Создание колоды**:
- Создается колода из 52 карт (13 рангов × 4 масти)
- Каждая карта представляется числом от 1 до 52
- Карты: 2♠=1, 3♠=2, ..., A♣=52

**Последовательное шифрование**:
```python
def deal_cards(self):
    encrypted_deck = list(range(1, 53))  # Карты как числа 1-52
    
    for player_id in range(self.num_players):
        Ci, Di = self.player_keys[player_id]
        
        # Шифруем каждую карту
        for i in range(len(encrypted_deck)):
            encrypted_deck[i] = self.mod_pow(encrypted_deck[i], Ci, self.p)
        
        # Перемешиваем зашифрованную колоду
        random.shuffle(encrypted_deck)
```

**Результат**:
- Колода зашифрована всеми игроками
- Порядок карт случайный
- Никто не знает, какая карта где находится

### 3. Раздача карт
**Процесс раздачи**:
- Каждый игрок получает 2 карты (закрытые)
- На стол выкладывается 5 общих карт
- Карты выбираются из зашифрованной колоды

**Расшифрование**:
- Игроки по очереди расшифровывают свои карты
- M = C^(k^(-1)) mod p, где k^(-1) - обратный к k
- Только владелец ключа может расшифровать карту

### 4. Определение победителя
**Анализ комбинаций**:
- Каждый игрок анализирует свои 2 карты + 5 общих
- Определяется лучшая покерная комбинация
- Сравниваются комбинации всех игроков

**Проверка честности**:
- Все операции могут быть проверены
- Невозможно подделать карты
- Невозможно подглядеть карты других игроков

### Алгоритм в коде
```python
def setup_cryptographic_parameters(self):
    """Настраивает криптографические параметры"""
    self.p = 1009  # Простое число
    self.g = 2     # Первообразный корень
    
    # Генерируем ключи для каждого игрока
    for i in range(self.num_players):
        key = random.randint(1, self.p - 1)
        self.player_keys[i] = key

def generate_deck(self):
    """Генерирует колоду карт"""
    suits = ['♠', '♥', '♦', '♣']
    ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A']
    
    self.deck = []
    for suit in suits:
        for rank in ranks:
            self.deck.append(f"{rank}{suit}")

def deal_cards(self):
    """Раздает карты игрокам"""
    # Перемешиваем колоду
    random.shuffle(self.deck)
    
    # Раздаем карты игрокам
    for i in range(self.num_players):
        player_cards = []
        for j in range(self.cards_per_player):
            card = self.deck.pop(0)
            player_cards.append(card)
        self.player_cards[i] = player_cards
    
    # Выкладываем общие карты
    self.community_cards_revealed = []
    for i in range(self.community_cards):
        card = self.deck.pop(0)
        self.community_cards_revealed.append(card)
```

### Криптографическая безопасность
**Защита от мошенничества**:
- Невозможно подделать карты без знания ключей
- Невозможно подглядеть карты других игроков
- Все операции проверяемы

**Ограничения текущей реализации**:
- Упрощенная криптографическая защита
- Отсутствие полной проверки честности
- Нет защиты от сговора игроков

**Возможные улучшения**:
- Реализация полного криптографического протокола
- Добавление проверки честности
- Защита от атак и сговора

## Использование

### Запуск приложения
```bash
python main.py
```

### Интерфейс
- **Настройки игры**: Выбор количества игроков (2-6)
- **Лог игры**: Отображение всех операций и событий
- **Карты игроков**: Показ карт каждого игрока
- **Управление**: Кнопки для раздачи карт и определения победителя

### Функции
- `Новая игра` - начать новую игру
- `Начать игру` - запустить игру с выбранными параметрами
- `Раздать карты` - раздать карты игрокам
- `Показать общие карты` - показать карты на столе
- `Определить победителя` - определить победителя игры

## Особенности реализации

### Криптографические функции
- Генерация простых чисел
- Модульная арифметика
- Случайная генерация ключей
- Шифрование/расшифрование карт

### Безопасность
- Каждый игрок имеет уникальный ключ
- Карты шифруются перед раздачей
- Проверка целостности колоды
- Защита от подглядывания

## Покерные комбинации

### Старшинство комбинаций (от старшей к младшей)
1. **Роял-флеш** - A, K, Q, J, 10 одной масти
2. **Стрит-флеш** - пять карт подряд одной масти
3. **Каре** - четыре карты одного достоинства
4. **Фулл-хаус** - три карты одного достоинства + пара
5. **Флеш** - пять карт одной масти
6. **Стрит** - пять карт подряд
7. **Тройка** - три карты одного достоинства
8. **Две пары** - две пары карт
9. **Пара** - две карты одного достоинства
10. **Старшая карта** - самая старшая карта

## Ограничения и улучшения

### Текущие ограничения
- Упрощенная логика определения победителя
- Отсутствие полной криптографической защиты
- Нет проверки честности игроков

### Возможные улучшения
- Реализация полного криптографического протокола
- Добавление проверки честности
- Улучшение логики определения победителя
- Добавление анимации и звуков
- Поддержка сетевой игры

## Математические основы

### Модульная арифметика
- Операции по модулю простого числа p
- Обратные элементы для расшифрования
- Случайные числа для генерации ключей

### Криптографические примитивы
- Генерация простых чисел
- Поиск первообразных корней
- Шифрование/расшифрование
- Проверка целостности

